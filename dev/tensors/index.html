<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tensors · Polynomials4ML.jl</title><meta name="title" content="Tensors · Polynomials4ML.jl"/><meta property="og:title" content="Tensors · Polynomials4ML.jl"/><meta property="twitter:title" content="Tensors · Polynomials4ML.jl"/><meta name="description" content="Documentation for Polynomials4ML.jl."/><meta property="og:description" content="Documentation for Polynomials4ML.jl."/><meta property="twitter:description" content="Documentation for Polynomials4ML.jl."/><meta property="og:url" content="https://ACEsuit.github.io/Polynomials4ML.jl/tensors/"/><meta property="twitter:url" content="https://ACEsuit.github.io/Polynomials4ML.jl/tensors/"/><link rel="canonical" href="https://ACEsuit.github.io/Polynomials4ML.jl/tensors/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Polynomials4ML.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Public API</span><ul><li><a class="tocitem" href="../api/">API Index</a></li><li><a class="tocitem" href="../polynomials/">Bases / Embeddings</a></li><li class="is-active"><a class="tocitem" href>Tensors</a><ul class="internal"><li><a class="tocitem" href="#API-for-Tensor-Layers"><span>API for Tensor Layers</span></a></li></ul></li><li><a class="tocitem" href="../integration/">Integration</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/">Tutorial Index</a></li><li><a class="tocitem" href="../literate_tutorials/polyregression/">Linear Regression</a></li></ul></li><li><span class="tocitem">Background</span><ul><li><a class="tocitem" href="../background/">Background Index</a></li><li><a class="tocitem" href="../SH/">Spherical and Solid Harmonics</a></li><li><a class="tocitem" href="../ace/">Cluster Expansion</a></li></ul></li><li><a class="tocitem" href="../docstrings/">Docstrings</a></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../benchmarking/">Benchmark Instructions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Public API</a></li><li class="is-active"><a href>Tensors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tensors</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ACEsuit/Polynomials4ML.jl/blob/{commit}{path}#{line}" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ACEsuit/Polynomials4ML.jl/blob/main/docs/src/tensors.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="API-for-Tensor-Layers"><a class="docs-heading-anchor" href="#API-for-Tensor-Layers">API for Tensor Layers</a><a id="API-for-Tensor-Layers-1"></a><a class="docs-heading-anchor-permalink" href="#API-for-Tensor-Layers" title="Permalink"></a></h2><p>P4ML also implements a few standard layers that occur in atomic cluster expansion (ACE) type models. These are all expressed as (usually symmetric) tensor operations. These are documented here. Some of these operations are quite unique (sparse symmetric tensor contractions) while others are more standard (`LinearLayer&#39;) and are provided here for conformity with our interface. </p><ul><li>LinearLayer  : todo add doc string</li><li>Sparse product : todo add doc string</li><li>Fused tensor product and pooling <a href="../docstrings/#Polynomials4ML.PooledSparseProduct"><code>PooledSparseProduct</code></a></li><li>Sparse symmetric product <a href="../docstrings/#Polynomials4ML.SparseSymmProd"><code>SparseSymmProd</code></a></li><li>Recursive sparse symmetric product implementation <a href="../docstrings/#Polynomials4ML.SparseSymmProdDAG"><code>SparseSymmProdDAG</code></a></li></ul><p>Their usage differs slightly from the polynomial embeddings. Evaluating a layer is the same and can be done both in-place and allocating, e.g., </p><pre><code class="language-julia hljs">abasis::PooledSparseProduct
evaluate!(A, abasis, BB)
A = evaluate(abasis, BB)</code></pre><p>We refer to the individual documentation for the details of the arguments to each layer.</p><p>All tensor layers can be conveniently used in a non-allocating way from a Bumper <code>@no_escape</code> block, e.g., </p><pre><code class="language-julia hljs">A = @withalloc evaluate!(absis, BB)</code></pre><h3 id="Pullbacks"><a class="docs-heading-anchor" href="#Pullbacks">Pullbacks</a><a id="Pullbacks-1"></a><a class="docs-heading-anchor-permalink" href="#Pullbacks" title="Permalink"></a></h3><p>All tensor layers have custom pullbacks implemented that can be accessed via non-allocating or allocating calls: </p><pre><code class="language-julia hljs">pullback!(∂X, ∂P, layer, X)
∂X = pullback(∂P, layer, X)</code></pre><h3 id="Pushforwards-and-Second-order-derivatives"><a class="docs-heading-anchor" href="#Pushforwards-and-Second-order-derivatives">Pushforwards and Second-order derivatives</a><a id="Pushforwards-and-Second-order-derivatives-1"></a><a class="docs-heading-anchor-permalink" href="#Pushforwards-and-Second-order-derivatives" title="Permalink"></a></h3><p>Pushforwards and reverse-over-reverse are implemented using ForwardDiff. This is quasi-optimal even for reverse-over-reverse due to the fact that it can be interpreted as a directional derivative on evaluate and pullback (after swapping derivatives). As a matter of fact, we generally recommend to not use these directly. ChainRules integration would give an easier use-pattern. For optimal performance the same technique to an entire model architecture rather than to each individual layer. This would avoid several unnecessary intermediate allocations.</p><p>The syntax for pushforwards is straightforward:</p><pre><code class="language-julia hljs">pushforward!(P, ∂P, layer, X, ∂X)
P, ∂P = pushforward(layer, X, ∂X)</code></pre><p>For second-order pullbacks the syntax is </p><pre><code class="language-julia hljs">∇_∂P, ∇_X = pullback2(∂∂X, ∂P, layer, X)
pullback2!(∇_∂P, ∇_X, ∂∂X, ∂P, layer, X)</code></pre><h3 id="Bumper-and-WithAlloc-usage"><a class="docs-heading-anchor" href="#Bumper-and-WithAlloc-usage">Bumper and WithAlloc usage</a><a id="Bumper-and-WithAlloc-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Bumper-and-WithAlloc-usage" title="Permalink"></a></h3><p>Using the <code>WithAlloc.jl</code> interface these can be used conveniently as follows (always from within a <code>@no_escape</code> block)</p><pre><code class="language-julia hljs">∂X = @withalloc pullback!(∂P, layer, X)
P, ∂P = @withalloc pushforward!(layer, X, ∂X)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../polynomials/">« Bases / Embeddings</a><a class="docs-footer-nextpage" href="../integration/">Integration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 20 June 2024 02:25">Thursday 20 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
